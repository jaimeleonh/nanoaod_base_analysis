<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Structure of the framework &mdash; nanoaod-base-analysis user guide 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/design-tabs.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="Installation.html" />
    <link rel="prev" title="Welcome to nanoaod-base-analysis’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            nanoaod-base-analysis user guide
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Structure of the framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#user-code">User code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Main code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Setting the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Environment.html">Setting the environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tasks.html">Executing tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/index.html">Modules Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq/index.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">nanoaod-base-analysis user guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Structure of the framework</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Structure.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="structure-of-the-framework">
<span id="structure"></span><h1>Structure of the framework<a class="headerlink" href="#structure-of-the-framework" title="Permalink to this heading"></a></h1>
<p>This framework is structured in two separate repositories, summarized in the next sections.</p>
<section id="user-code">
<h2>User code<a class="headerlink" href="#user-code" title="Permalink to this heading"></a></h2>
<p>It should contain the user’s configuration and custom tasks. As an example, <a class="reference external" href="https://github.com/jaimeleonh/hhbbtt-analysis">this repository</a>
includes the code used for the HH-&gt;bbtt analysis, and it can be used as an example to add the desired configuration.</p>
<p>It contains two folders:</p>
<ul class="simple">
<li><p><em>Config</em>: it contains different files in yaml and python format to define the configuration of the analysis.</p></li>
<li><p><em>Tasks</em>: files in python format. Custom tasks (i.e. specific from your analysis or modifying a common task) can be stored here taking advantage of inheritance.</p></li>
</ul>
</section>
<section id="id1">
<h2><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/nanoaod_base_analysis/">Main code</a><a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Base code of the framework that shouldn’t be modified unless there is any improvement suggestion. In this repository there are several folders, some of them just to document information about the code, and inside the main one (<em>/cmt/</em>) are a few relevant files on our understanding of the code:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/nanoaod_base_analysis/-/blob/py3/cmt/base_tasks/preprocessing.py">preprocessing.py</a>: main tasks of the code to process data and to count events are defined here.</p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/nanoaod_base_analysis/-/blob/py3/cmt/base_tasks/plotting.py">plotting.py</a>: definitions of the tasks used to make plots of the processed data.</p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/nanoaod_base_analysis/-/blob/py3/cmt/config/base_config.py">base_config.py</a>: useful datasets and definitions of the mandatory variables for the analysis.</p></li>
</ul>
<p>All this code gives us the opportunity to execute multiple tasks depending on what we want to do, and can be summarized with this diagram:</p>
<img alt="_images/lawStructure.png" src="_images/lawStructure.png" />
<p>Where there are two branches of tasks before plotting depending on what the goal is: event counting or processing data.
In the section <a class="reference internal" href="Tasks.html#tasks"><span class="std std-ref">Executing tasks</span></a> you can see step by step how it works and which are the specific tasks the code can make.</p>
<section id="environment-variables">
<h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this heading"></a></h3>
<p>Inside the user and main code there is a <em>setup</em> file, where multiple directories are defined with a variable name. The source file of the main code define:</p>
<ul id="directories-layout">
<li><p><strong>Directories layout</strong>: Important directories and what you can file inside of them:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>$CMT_STORE</strong>: output files of every task.</p></li>
<li><p><strong>$CMT_JOB_DIR</strong>: scripts of the jobs that are being executed.</p></li>
<li><p><strong>$CMT_TMPDIR</strong>: temporal files that are produced during the execution of all tasks.</p></li>
<li><p><strong>$CMT_STORE_LOCAL</strong>: condor status, submission information and logs.</p></li>
<li><p><strong>$CMT_GFAL_DIR</strong>: Grid File Access Library.</p></li>
<li><p><strong>$CMT_REMOTE_JOB</strong>: number of jobs (not a directory, but still may be useful).</p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Useful <strong>Git repositories</strong>:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://github.com/cms-nanoAOD/nanoAOD-tools">CMS-nanoAOD-tools ($NANOTOOLS_PATH)</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/cmt-base-modules">Base modules cms-phys-ciemat ($BASEMODULES_PATH)</a></p></li>
<li><p><a class="reference external" href="https://github.com/bvormwald/HHKinFit2/tree/CMSSWversion">HHKinFit2 ($HHKINFIT_PATH)</a></p></li>
<li><dl class="simple">
<dt>SVfit (<em>$SVFIT_PATH</em>) with two repositories:</dt><dd><ul>
<li><p><a class="reference external" href="https://github.com/LLRCMS/ClassicSVfit/tree/bbtautau_LegacyRun2">Classic SVfit</a></p></li>
<li><p><a class="reference external" href="https://github.com/svfit/SVfitTF">SVfitTF</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/diegof/gem-modules">GEM Modules ($GEM_PATH)</a></p></li>
<li><dl class="simple">
<dt>HTT-utilities (<em>$HTT_PATH</em>) with several repositories:</dt><dd><ul>
<li><p><a class="reference external" href="https://github.com/CMS-HTT/LeptonEff-interface">LeptonEff-interface</a></p></li>
<li><p><a class="reference external" href="https://github.com/CMS-HTT/LeptonEfficiencies">Lepton Efficiencies</a></p></li>
<li><p><a class="reference external" href="https://github.com/cms-tau-pog/TauTriggerSFs/tree/run2_SFs">TauAnalysisTools</a></p></li>
<li><p>TauAnalysisTools data: <a class="reference external" href="https://github.com/camendola/VBFTriggerSFs/raw/master/data/2017_VBFHTauTauTrigger_JetLegs.root">data1</a> , <a class="reference external" href="https://github.com/camendola/VBFTriggerSFs/raw/master/data/2018_VBFHTauTauTrigger_JetLegs.root">data2</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/hh-italian-group/HHbtag">HHbtag ($HHBTAG_PATH):</a></dt><dd><ul>
<li><p><a class="reference external" href="https://gitlab.cern.ch/hh/bbtautau/MulticlassInference">hh/bbtautau</a></p></li>
<li><p><a class="reference external" href="https://github.com/jaimeleonh/InferenceTools">InterferenceTools</a></p></li>
<li><p><a class="reference external" href="https://github.com/GilesStrong/cms_hh_proc_interface">cms_hh_proc_interface</a></p></li>
<li><p><a class="reference external" href="https://github.com/GilesStrong/cms_hh_tf_inference">cms_hh_tf_inference</a></p></li>
<li><p><a class="reference external" href="https://github.com/GilesStrong/cms_runII_dnn_models">cms_runII_dnn_models</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Corrections (<em>$CORRECTIONS_PATH</em>):</dt><dd><ul>
<li><p><a class="reference external" href="https://github.com/jaimeleonh/correctionlib-wrapper/tree/cmssw_version">correctionlib-wrapper</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/tau-corrections">tau-corrections</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/jme-corrections">jme-corrections</a></p></li>
<li><p>jme-corrections data: <a class="reference external" href="https://github.com/cms-jet/JECDatabase/raw/master/tarballs/Summer19UL18_V5_MC.tar.gz">1</a>, <a class="reference external" href="https://github.com/cms-jet/JECDatabase/raw/master/tarballs/Summer19UL17_V5_MC.tar.gz">2</a>, <a class="reference external" href="https://github.com/cms-jet/JECDatabase/raw/master/tarballs/Summer19UL16_V7_MC.tar.gz">3</a>, <a class="reference external" href="https://github.com/cms-jet/JECDatabase/raw/master/tarballs/Summer19UL16APV_V7_MC.tar.gz">4</a>.</p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/lum-corrections">lum-corrections</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/muo-corrections">muo-corrections</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/egm-corrections">egm-corrections</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/btv-corrections">btv-corrections</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Software (<em>$CMT_SOFTWARE</em>):</dt><dd><ul>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/analysis_tools">analysis_tools</a></p></li>
<li><p><a class="reference external" href="https://gitlab.cern.ch/cms-phys-ciemat/plotting_tools">plotting_tools</a></p></li>
<li><p><a class="reference external" href="https://github.com/riga/law">law</a></p></li>
<li><p><a class="reference external" href="https://github.com/riga/plotlib">plotlib</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>CMS Software</strong>: you cand find the CMS software used for this framework inside <em>Reponame/nanoaod_base_analysis/data/cmssw/</em>, also associated to the variable <em>$CMT_CMSSW_BASE</em>. Also, you can see the version with <em>$CMT_CMSSW_VERSION</em>.</p></li>
<li><p><strong>$PYTHONPATH</strong> and <strong>$CMT_PYTHON_VERSION</strong>.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to nanoaod-base-analysis’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>