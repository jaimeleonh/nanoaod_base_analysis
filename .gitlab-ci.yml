cmssw_setup:
  image: gitlab-registry.cern.ch/ci-tools/ci-worker:cc7
  tags:
    - cvmfs
  variables:
    # This is also set on LXPLUS
    CMS_PATH: /cvmfs/cms.cern.ch
    CMT_CERN_USER: jleonhol
  script:
    # IMPORTANT: Expand aliases in noninteractive bash mode
    # Otherwise cmsrel and cmsenv won't work
    - shopt -s expand_aliases
    - yum install -y python3
    # access CVMFS
    - set +u && source ${CMS_PATH}/cmsset_default.sh; set -u
    - set +u && source setup.sh set -u
    - cd docs
    - make html
    - cp -r build/* ../_readthedocs 
    - cd ..
    - git config --global user.email "ci@nanoaod_base_analysis.com"
    - git config --global user.name "CI"
    - git add _readthedocs/*
    - git remote -v
    - git branch
    - git commit -m "Update readthedocs"
    - git push origin py3
